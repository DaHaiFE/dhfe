(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{340:function(e,t,s){"use strict";s.r(t);var n=s(1),r=Object(n.a)({},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"content"},[e._m(0),s("p",[e._v("1.上传图片参数")]),s("p",[e._v("2.上传图片获取不同的上传地址")]),s("p",[e._v("3.上传图片报错")]),s("p",[e._v("4.显示已经上传的图片。")]),s("p",[e._v("5.保存上传图片传参给后端。")]),s("p",[e._v("6.删除图片功能。")]),s("p",[e._v("7.图片放大功能")]),s("p",[e._v("希望开发类似功能的同事避免一些开发前没想到的问题。")]),e._m(1),e._m(2),s("p",[e._v("js代码")]),e._m(3),s("p",[e._v("最多上传图片数")]),e._m(4),s("p",[e._v("上传文件之前调用的函数，可设置上传图片大小和格式")]),e._m(5),s("p",[e._v("点击某一个图片放大该图片")]),e._m(6),s("p",[e._v("图片上传成功调用的函数")]),e._m(7),s("p",[e._v("删除文件列表时调用的函数钩子。")]),e._m(8),s("p",[e._v("接下来写下在整个开发中遇到的问题，出现问题的原因，及解决方案")]),e._m(9),s("p",[e._v("问题：,每个环境下对应不同图片上传地址，不同的环境需要修改一次代码太麻烦啦！")]),s("p",[e._v("解决方案：asynData 方法能够在渲染组件之前异步获取数据，env属性能够获取nuxt.config.js 中配置的环境变量，所以我们在nuxt.dev.config.js中配置了以下地址")]),e._m(10),s("p",[e._v("在nuxt.prod.config.js中配置了以下地址")]),e._m(11),s("p",[e._v("这样我们就可以通过asyncData函数的env属性动态获取不同环境下的上传地址啦,代码如下：。")]),e._m(12),s("p",[e._v("写到这里，我以为上传的代码已经开发完然而却又遇到下面问题")]),e._m(13),s("p",[e._v("问题：页面直接报错uid is not a function,图片上传失败")]),s("p",[e._v('原因：:file-list="upForm.exam_pics" file-list是一个对象数组，并且默认需要图片uid，而examSuccess()函数中upForm.exam_pics是一个')]),s("p",[e._v("数组，没有uid这个值，并且后台也只关心图片存储地址，所以只能返回图片地址，从后台是没法拿到uid值。")]),s("p",[e._v("解决方:：直接去掉:"),s("el-upload"),e._v('组件中的:file-list="upForm.exam_pics，在试着上传发现可以上传成功了。')],1),e._m(14),s("p",[e._v("问题：再次进入页面，之前上传的图片缩略图并未显示出来。")]),s("p",[e._v('原因：因为去掉了组件中:file-list="upForm.exam_pics" 没了这个属性那图片当然就展示不出来了。')]),s("p",[e._v("解决方案：上传图片时给upForm.exam_pics()添加uid属性。examSuccess方法改为：")]),e._m(15),e._m(16),s("p",[e._v("问题：传值失败")]),s("p",[e._v("原因：后台需要的参数是数组，不是对象，我需要的是一个对象而后台返回数组")]),s("p",[e._v("解决方案:把后台返回数组转为对象，在给后台传值时把对象在转为数组，方法如下:")]),s("p",[e._v("对象转数组在给后台传参是调用")]),e._m(17),s("p",[e._v("数组转对象在接收后台返回图片列表时调用")]),e._m(18),e._m(19),s("p",[e._v("问题：删除某张图片时，页面又报错Uncaught TypeError: this.upForm.exam_pics.files.filter is not a function，删除图片失败。")]),s("p",[e._v("在看之前写的删除方法")]),e._m(20),s("p",[e._v("原因：通过filter()是一个数组方法，通过之前的数组转对象方法，当前的this.upForm.exam_pics是一个对象，所以删除方法报错")]),s("p",[e._v("解决方案如下：")]),e._m(21),e._m(22),s("p",[e._v("问题：测试图片放大功能，却发现点击无效。")]),s("p",[e._v("原因：图片上未绑定点击预览功能")]),s("p",[e._v("解决方案：升级element组件库,给图片绑定点击预览功能。")])])},[function(){var e=this.$createElement;return(this._self._c||e)("p",[this._v("同时上传多张图片，默认显示之前已经上传的图片列表，双击图片放大等功能。\n"),this._v("\n我在开发图片上传功能时遇到几个问题，现在总结如下：")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"_1-上传图片参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-上传图片参数","aria-hidden":"true"}},[this._v("#")]),this._v(" 1.上传图片参数")])},function(){var e=this.$createElement,t=this._self._c||e;return t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('<el-upload>\n  class="upload-demo" //自定义样式\n  ref="exercises-pics" //ref 用了被用来给DOM元素或直接操作DOM元素。注意：vue直接操作DOM就必须用ref 属性进行注册\n  :action="uploadApi" //图片上传地址\n  :data="uploadData"  //上传图片所传参数。\n  :on-success="examSuccess"//文件上传成功时的钩子\n  :before-upload="beforeUpload"//上传文件之前的钩子成功失败都会调用\n  :on-preview="handlePreview" // 点击文件列表中已上传的文件时的钩子 图片放大时用到。\n  :on-remove="handleRemove" // 删除文件列表时调用的函数钩子。\n  :multiple="true" //支持多选文件\n  :on-exceed="handleLimit" //文件超出个数限制的钩子\n  list-type="picture" //文件列表类型\n  :file-list="upForm.exam_pics" // 上传的文件列表\n  <el-button size="small" type="primary" class="upBtn">上传试卷图片</el-button>\n</elupload>\n')])])},function(){var e=this.$createElement,t=this._self._c||e;return t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("const ACCESS_TOKEN =some.access_token : ''\nexport default {\n return {\n   uploadApi: '',\n   upForm: {\n     exam_pics: []\n   },\n   uploadData: {\n     project: 'crm',\n     business: 'exam_paper',\n     access_token: ACCESS_TOKEN\n   }\n  },\n  methods: {\n")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("    handleLimit(file,fileList) {\n      this.overForm('最多上传10张图片', 1)\n    },\n")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("     beforeUpload(file) {\n       const isType = file.type\n       const isLt5M = file.size / 1024 < 5120\n       if (isType !== 'image/jpeg' && isType !== 'image/png') {\n         this.$message.error('上传图片只能是 jpg/png 格式!')\n         return false\n       } else if (!isLt5M) {\n         this.$message.error('上传图片大小不能超过 5M!')\n         return false\n       }\n     }\n    },\n")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("    handlePreview(file) {\n      window.open(file.response.result[0])\n    },\n")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('    examSuccess(response, file, fileList) {\n      if (response.status === 1) {\n        for (let i = 0; i < response.result.length; i++) {\n          if(response.result[i].indexOf("http") !=-1){\n            this.upForm.exam_pics.push(response.result[0])\n          }\n        }\n       } else {\n         this.$message({\n           message: response.message\n        })\n       }\n     }\n')])])},function(){var e=this.$createElement,t=this._self._c||e;return t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v(" handleRemove(file, fileList) {\n   let picture = this.upForm.exam_pics.filter((item, index, arr) => {\n     return item !== file.response.result[0]\n   })\n   this.upForm.exam_pics = picture\n },\n}\n},\n")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"_2-上传图片获取不同的上传地址"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-上传图片获取不同的上传地址","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.上传图片获取不同的上传地址")])},function(){var e=this.$createElement,t=this._self._c||e;return t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v(" env: {testPaperAnalysisUpload: '//some.domain.com/upload/localfile'}\n")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v(" env: {testPaperAnalysisUpload: '//some.domain.com/upload/localfile'}\n")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("  asyncData({env}) {\n    return {uploadApi: env.testPaperAnalysisUpload}\n  }\n}\n")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"_3-上传图片报错"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-上传图片报错","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.上传图片报错")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"_4-显示已经上传的图片。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-显示已经上传的图片。","aria-hidden":"true"}},[this._v("#")]),this._v(" 4.显示已经上传的图片。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("examSuccess(response, file, fileList) {\n      if (response.status === 1) {\n        for (let i = 0; i < response.result.length; i++) {\n          if(response.result[i].indexOf(\"http\") !=-1){\n            this.upForm.exam_pics.push({\n            url: response.result[0],\n            uid: 'id'+i\n            })\n            }\n          }\n        }\n       } else {\n         this.$message({\n           message: response.message\n        })\n       }\n     }\n这样上传就不会报错了。\n")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"_5-保存上传图片传参给后端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-保存上传图片传参给后端","aria-hidden":"true"}},[this._v("#")]),this._v(" 5.保存上传图片传参给后端")])},function(){var e=this.$createElement,t=this._self._c||e;return t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("let split = (which) => {\n  return which.map((i) => i.url)\n}\n\n")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v(" let join = (origin) => {\n  return origin.map(i => ({url: i}))\n }\n\n")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"_6-删除图片功能。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-删除图片功能。","aria-hidden":"true"}},[this._v("#")]),this._v(" 6.删除图片功能。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v(" handleRemove(file, fileList) {\n   let picture = this.upForm.exam_pics.filter((item, index, arr) => {\n     return item !== file.response.result[0]\n   })\n   this.upForm.exam_pics = picture\n }\n\n")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("handleRemove(file, fileList) {\n  let picture = this.upForm.exam_pics.filter(val => {\n    return val.url !== file.response.result[0]\n  })\n  this.upForm.exam_pics = this.upForm.exam_pics.push(picture)\n}\n再次测试删除，显示之前保存的缩略图都可以正常显示啦\n")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"_7-图片放大功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-图片放大功能","aria-hidden":"true"}},[this._v("#")]),this._v(" 7.图片放大功能")])}],!1,null,null,null);r.options.__file="vue-upload.md";t.default=r.exports}}]);